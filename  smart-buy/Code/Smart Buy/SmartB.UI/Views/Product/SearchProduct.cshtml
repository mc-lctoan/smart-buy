@model PagedList.IPagedList<SmartB.UI.Areas.Admin.Models.ProductInfo>
@using PagedList.Mvc;
@{
    ViewBag.Title = "SearchProduct";
    Layout = "~/Views/Shared/_LayoutNew.cshtml";
}

@section head
{
    <link href="@Url.Content("~/Content/PagedList.css")" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="@Url.Content("~/Scripts/utils/productUtils.js")"></script>

    <!-- Metro -->
    <link rel="stylesheet" href="@Url.Content("~/Template/Metro/css/metro-bootstrap.css")" />
    <script src="@Url.Content("~/Template/Metro/js/jquery/jquery.widget.min.js")"></script>
    <script src="@Url.Content("~/Template/Metro/js/metro/metro.min.js")"></script>
    <link href="@Url.Content("~/Content/Order.css")" rel="stylesheet" type="text/css" />
}
<script>
    $(document).ready(function () {
        $("#order-total").load("../Cart/ViewCart #order-total-detail");
        $("#order-summary").show();
        
        //if ($("#order-total").load("../Cart/ViewCart #order-total-detail").text() == "") {
        //    $("#order-summary").hide();
        //} 
    });
</script>
<div id="Contain">
    <div class="ProductDetail" >
        <div class="Tools">
            <div class="Left">
                <ul class="SortTool">
                    <li style="padding: 8px 30px; cursor: auto; background-color: #3399FF; color: white !important;">
                        <a style="color:white" href="@Url.Action("Index", "Home")">Trang chủ</a>
                        @*<span class="arrowFilter-left"></span>*@
                    </li>
                    <li style="padding: 8px 30px; cursor: auto;">Tìm kiếm sản phẩm
                    </li>
                </ul>
            </div>
            <div class="clr"></div>
        </div>
    </div>
    <div class="main-content" style="padding: 60px 20px 20px; min-height: 560px;">
        <div >
            @using (Html.BeginForm("SearchProduct", "Product", FormMethod.Get, new { role = "search" }))
            {
                <div class="metro">
                    <div class="input-control text size5">
                        @Html.TextBox("q", ViewBag.CurrentFilter as string, new { id = "q", type = "text", placeholder = "Tên sản phẩm" })
                        <button type="submit" class="btn-search"></button>
                    </div>
                </div>
            }

            @if (Model != null)
            {
                <div class="ProductNameDetail">Kết quả tìm kiếm</div><br />
            <div style="font-weight:bold;text-align:right">*Đơn vị tính Nghìn đồng.</div>
                <table class="table table-bordered table-hover">
                    <thead>
                        <tr>
                            <th style="width:55%">Tên sản phẩm</th>
                            <th style="width:15%">Giá sản phẩm</th>
                            <th style="width:30%">Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>@Html.DisplayFor(modelItem => item.Name)
                                    @{
                            var productId = item.ProductId;
                            var productName = item.Name;
                                    }

                                </td>

                                <td>@Html.DisplayFor(modelItem => item.MinPrice) - @Html.DisplayFor(modelItem => item.MaxPrice)
                                    @{
                            var minPrice = item.MinPrice;
                            var maxPrice = item.MaxPrice;
                                    }
                                </td>
                                <td>
                                    <div class="metro">
                                        <button class="success" onclick="addToCart('@productId')">
                                            <i class="icon-plus-2 on-left"></i>
                                            Thêm
                                        </button>

                                        <button class="editDialog inverse">
                                            <i class="icon-dollar on-left"></i>
                                            Đề xuất giá                                
                                        </button>
                                    </div>
                                    <script>

                                        $(".editDialog").on("click", function (e) { // e.preventDefault(); use this or return false
                                            $.Dialog({
                                                overlay: true,
                                                shadow: true,
                                                flat: true,
                                                icon: '<i class="icon-dollar-2 on-left"></i>',
                                                title: 'Đề xuất giá',
                                                content: '',
                                                padding: 10,
                                                onShow: function (_dialog) {
                                                    var content = ["<iframe id='iframeId' width='420' height='260' scrolling='no' src='/Product/ProposeProductPrice/" + @productId + "' frameborder='0'></iframe>"].join('');
                                                        $.Dialog.content(content);
                                                        $.Metro.initInputs();
                                                    }
                                                });
                                                return true;
                                            });
                                    </script>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>    
                @Html.PagedListPager(Model, page => Url.Action("SearchProduct", new { currentFilter = ViewBag.CurrentFilter, page }), PagedListRenderOptions.OnlyShowFivePagesAtATime)
            }
            else
            {
                @Html.Action("ProductMostBuy")
            }
        </div>
    </div>
</div>
